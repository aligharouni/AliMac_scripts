\documentclass[12pt]{article}
\usepackage{natbib}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage[nameinlink,capitalize]{cleveref}
\usepackage{cleveref}
\usepackage[margin=1in]{geometry}
\usepackage{lineno}\renewcommand\thelinenumber{\color{gray}\arabic{linenumber}}
\usepackage{pdflscape}
\usepackage{xspace}
\usepackage{array}
\usepackage{tikz}

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\newcommand{\comment}{\showcomment}
\newcommand{\showcomment}[3]{\textcolor{#1}{\textbf{[#2: }\textsl{#3}\textbf{]}}}
\newcommand{\nocomment}[3]{}
\newcommand{\pkg}[1]{\textsf{#1}}  %{\texttt{#1}}
\newcommand{\ncurve}{\ensuremath{N_{\textrm{curves}}}\xspace}
\newcommand{\nsample}{\ensuremath{N_{\textrm{samples}}}\xspace}

\newcommand{\ali}[1]{\comment{magenta}{Ali}{#1}}
\newcommand{\bmb}[1]{\comment{red}{BMB}{#1}}
\newcommand{\todo}[1]{\comment{red}{TODO}{#1}}

\theoremstyle{definition} % amsthm only
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
 
\bibliographystyle{apalike}

\title{Comment on \cite{juul2021fixed}}
\author{Ali Gharouni, Ben Bolker}

\begin{document}
\maketitle
\linenumbers

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Abstract}
%\bmb{revisit after revising body}
%This is a commentary work motivated by \cite{juul2021fixed}'s work in which a few useful ideas of the concept of the central set out of an ensemble of epidemic curves were presented. In the present work we provide alternative, and more principled, curved-based statistics approaches to approximate the most central set which represents the central 50\% of the ensemble. In particular, we use three functional ranking methods; (1) the sampling-based, fast and robust functional boxplot, 
%(2) pairwise distances (eg, $\ell_2$ norm) between the curves and quantiles of centrality, and (3) a multivariate generalization of ranking the curves by using Mahalanobis distance among features of interest. We apply our methods on \cite{juul2021fixed}'s dataset and compare our results with theirs.      

%\section{Introduction}

\cite{juul2021fixed} pointed out shortcomings to the standard ways that researchers draw confidence intervals for ensembles of curves, with specific examples drawn from the output of stochastic epidemic models. In particular, they showed that fixed-time approaches (e.g., computing pointwise quantiles) can fail to capture the uncertainty in key features of an epidemic such as the timing and magnitude of epidemic peaks.  As an alternative to fixed-time approaches, the authors illustrated methods to compute the \emph{central set} of an ensemble of curves, a high-dimensional analogue of interquartile range or confidence interval. There is a large body of literature on this topic under the rubrics of \emph{functional depth} and \emph{functional boxplots} for high dimensional data \citep{fraiman2001trimmed, lopez2007depth, lopez2009concept, sun2011functional,sun2012exact}. While \cite{juul2021fixed} do cite this literature \citep{sun2011functional}, exploring it in more depth led us to several useful practical and theoretical points that could be useful for researchers interested in using these approaches.

\cite{juul2021fixed}'s primary method for determining a curve's centrality (and hence whether it should be included in a central set of curves for display) was to measure the fraction of times that a given curve is completely included within the envelope of a set of tuning parameter (as \cite{lopez2009concept} used for $J$) $J=50$ (\cite{juul2021fixed} call this value \ncurve) other randomly sampled curves from the ensemble; they chose $\nsample=100$ sets of such samples to compute the fraction. They provided open-source Python code that implements this method, as well as some of the weighted variants they discuss. For the simple (unweighted) case, however, there are already mature open source implementations available in R \citep{fda_pkg,roahd}, Matlab (\url{https://www.psych.mcgill.ca/misc/fda/downloads/FDAfuns/}), and Python \citep{seabold2010statsmodels}. In general these packages use the same functional band depth measure as \cite{juul2021fixed}, but substituting $J=2$, which is robust \citep{lopez2009concept} and allows the use of a computationally efficient algorithm for large data sets \citep{sun2012exact}
% \cite{lopez2009concept} comment that ``the band depth order is very stable in $J$''; they use $J=3$.
It is unclear why \cite{juul2021fixed} chose larger values of $J$ (10 and 50), although the dimensions of their examples are small enough that the computational burden is not important.

%\bmb{what else do \cite{sun2012exact} say about tradeoffs (other than computational) for using larger values of \ncurve \ldots ? Any clues as to why Juul et al might have chosen their values?}
%\ali{ I think: \\
%1. Functional band depth of a function is sensitive to the shape and the position (or shift) of a function in comparison to the rest of ensemble members. Smaller values for $J$ allow for more shape sensitivity of the approach and are significantly faster to compute \cite{lopez2009concept} (see page 4 of \cite{lopez2009concept} in their example; for $J\geq 3$, The mean integrated error is minimized for $J=3$, thus the deepest curve is the same for $J\geq 3$. Note, mean integrated error is defined as the mean sample error from the sample median curve, $\hat m_{n,J}$ and defined as the curve in the sample with the highest depth value,  / or we can say the changes in sensitivity of the BD, deepest curves, to the choice of $J\geq 3$ is negligible see Fig.3 in \cite{lopez2009concept}).\\
%2. Not sure why Juul et al chose $\ncurve=50$, I have an odd feeling that maybe it is to do with the fact that the peaks lie between day 50 to day 100, in their dataset, and they chose $\ncurve=10$ when they use only the part of curves between day 50 and day 100.  


%We also use pairwise distances between the curves and quantiles of centrality as an alternative method to a sampling-based functional boxplot. In particular, we compute all pairwise distances -- here we used $\ell_2$ norm which gives the area between the two curves -- between the curves, determine the median-like distance of a curve to all others as the minimum of sum of distances, estimate the distribution of distances. The curve-based descriptive statistics is as follows;
%(1) ranking the curves from more central, i.e., closer to the distribution median to less central, and (2) plot the envelope containing the most central curves, i.e. the pointwise min/max curves of a subset of curves with the lowest sum (or sum of squares) of distances to the other curves. Note that the distribution median and mean are highly correlated and in this context median makes the most sense \ali{(the mean of an ensemble is not an appropriate representative of an ensemble \cite{donoho1992breakdown})}. Also, the most central set depends on the choice of the functional norm and further research is needed for clarification. We caution that functional norms that gives a distance of exactly zero on a slightly time-shifted step function (e.g., Fr√©chet distance and dynamic time-warping \ali{refs?}) seems inappropriate.

\cite{juul2021fixed} also suggest ranking according to a single, one-dimensional feature of interest such as the maximum values of newly hospitalized cases in a single day (their Fig.~2e). We suggest that this approach could be extended to incorporate multiple features of interest. Functional band depth could again be used on this reduced set of features; here we use the \emph{Mahalanobis distance} \citep{mahalanobis1936generalized}, which measures distance from a centroid accounting both for variation in the scales or typical magnitudes of different features and for correlation among features.
%\bmb{took out comment about MD being appropriate only if shape of feature cloud is $\approx$ MVN (in particular not bimodal): add it back in?}
%The envelope of the most central curves includes the curves with the rank within the 50\% quantile. The Mahalanobis distance provides a measure of similarity between multivariate data and uses covariance information between features to weight the contributions to the distance. The Euclidean distance, on the other hand, in essence gives excess weight to variables (features) that are highly correlated and gives additional weight to variables that have similar information. The Mahalanobis distance gives less weight to those variables that have high variance and to those variables that have high correlation, so that other feature variables with lower correlations can contribute to the distance.
%One potential problem with Mahalanobis distances: if (for example) the probe distribution is strongly bimodal, then scaling factors/correlations derived from the overall data set may not be appropriate for scaling the components of distance between two trajectories whose features
% put them in the same mode/component of the distribution.
Our example uses a feature set including the peak value of incidence (new infections), the time at which the peak occurs, and the initial growth rate, duration, and final size of the epidemic. While these are typical epidemiological features of interest, researchers can and should choose the features that are most closely connected to their particular research questions \citep{probert2016decision}.

\begin{figure}[h!]
  \centering
  \includegraphics[width=\linewidth]{scripts/cent_plot.pdf}
  \caption{Comparison of alternative methods of functional boxplots. FBD = functional band distance, $J$ = number of curves used for centrality calculation. Curve with $J=2$ computed via the \texttt{roahd} package \citep{roahd}: curve with $J=50$ used our own implementation of the functional band distance algorithm described by \cite{juul2021fixed}.
  }
  \label{p.a}
\end{figure}

\bmb{do we know why juul curve is different from fda? can we check and see if juul algorithm converges to fda for ncurves=2, or if fda converges to juul for ncurves=50? do roahd and fda give similar curves?}
  
\bibliography{./AliMac}
\end{document}
