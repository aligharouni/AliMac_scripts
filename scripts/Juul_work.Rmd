---
title: "Juul's paper"
author: "Ali"
date: "`r format(Sys.time(),'%d %b %Y')`"
output: html_document
bibliography: ../AliMac.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo=FALSE, message=FALSE}
##setwd("~/projects/AliMac_scripts/scripts/")
library("reticulate") ## use_python("/usr/bin/python3")
library(SimilarityMeasures) ## for Fr√©chet distance computation
```


## Juul et al's sample data set

This is inspired by @juul2021fixed. 
Retrieving and unpacking the simulated epidemic curves from
the [curvestat repo](https://github.com/jonassjuul/curvestat/).

`npy`-loading instructions  taken from [here](https://cran.r-project.org/web/packages/RcppCNPy/vignettes/UsingReticulate.pdf)

```{r get_juul}
if (!file.exists("./data/juul1.csv")) {
    download.file("https://github.com/jonassjuul/curvestat/raw/master/curvestat/tests/test_data/curves_DKE3.npy", dest="./data/juul1.npy")
    library(reticulate)
    np <- import("numpy")
    a <- np$load("./data/juul1.npy",allow_pickle=TRUE)[[1]]
    m <- do.call(cbind,a)
    write.table(m,file="./data/juul1.csv",row.names=FALSE,col.names=FALSE,
                sep=",")
} else {
    m <- as.matrix(read.csv("./data/juul1.csv")) ## the columns are the trajs
}
```

```{r plot_juul}
par(las=1,bty="l")
matplot(m,type="l",col=adjustcolor("black",alpha.f=0.2), lty=1,
        ylab="")
```

```{r frechet_dist, eval=FALSE}
n_traj <- ncol(m)
dmat_fr <- matrix(NA, n_traj, n_traj) ## Frechete
dmat_DTW <- matrix(NA, n_traj, n_traj) ## DTW
diag(dmat_fr) <- 0
diag(dmat_DTW) <- 0

system.time(
for (i in 1:(n_traj-1)) {
    for (j in (i+1):n_traj) {
        dmat_fr[i,j] <- Frechet(matrix(m[,i]),matrix(m[,j]))
        dmat_DTW[i,j] <- DTW(matrix(m[,i]),matrix(m[,j]))
    }
}

)

dmat_fr <- make_symm(dmat_fr)
stopifnot(isSymmetric(dmat_fr))

dmat_DTW <- make_symm(dmat_DTW)
stopifnot(isSymmetric(dmat_DTW))

write.table(dmat_fr,"./data/dmat_frechet.csv",sep=",",row.names = F,
                 col.names = F)
write.table(dmat_DTW,"./data/dmat_DTW.csv",sep=",",row.names = F,
                 col.names = F)

```



```{r install_curvestat}
library(reticulate)
## ~/Downloads$ sudo apt-get install python3-pip
## clone the curvestats in projects dir
## pip3 install curvestat
py_install("curvestat",pip=TRUE)
while (!py_module_available("curvestat")) {
    py_install("../curvestat",pip=TRUE)
}

## create a new environment 
## conda_create("r-reticulate")
## install curvestat
## conda_install("r-reticulate", "curvestat")
## curvestat <- import("curvestat")
```

```{python}
from curvestat import CurveBoxPlot
from curvestat import LoadRisk
```


# References



